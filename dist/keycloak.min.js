!function(a,b){var c=function(b){function i(){return"/"==d.authServerUrl.charAt(d.authServerUrl.length-1)?d.authServerUrl+"realms/"+encodeURIComponent(d.realm):d.authServerUrl+"/realms/"+encodeURIComponent(d.realm)}function j(){return a.location.origin?a.location.origin:a.location.protocol+"//"+a.location.hostname+(a.location.port?":"+a.location.port:"")}function k(a,b){function n(c,e,f,h){g=(g+(new Date).getTime())/2,m(c,e,f,g),d.tokenParsed&&d.tokenParsed.nonce!=a.storedNonce||d.refreshTokenParsed&&d.refreshTokenParsed.nonce!=a.storedNonce||d.idTokenParsed&&d.idTokenParsed.nonce!=a.storedNonce?(console.info("[KEYCLOAK] Invalid nonce, clearing token"),d.clearToken(),b&&b.setError()):h&&(d.onAuthSuccess&&d.onAuthSuccess(),b&&b.setSuccess())}var c=a.code,e=a.error,f=a.prompt,g=(new Date).getTime();if(e)if("none"!=f){var h={error:e,error_description:a.error_description};d.onAuthError&&d.onAuthError(h),b&&b.setError(h)}else b&&b.setSuccess();else if("standard"!=d.flow&&(a.access_token||a.id_token)&&n(a.access_token,null,a.id_token,!0),"implicit"!=d.flow&&c){var j="code="+c+"&grant_type=authorization_code",k=i()+"/protocol/openid-connect/token",l=new XMLHttpRequest;l.open("POST",k,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.clientId&&d.clientSecret?l.setRequestHeader("Authorization","Basic "+btoa(d.clientId+":"+d.clientSecret)):j+="&client_id="+encodeURIComponent(d.clientId),j+="&redirect_uri="+a.redirectUri,l.withCredentials=!0,l.onreadystatechange=function(){if(4==l.readyState)if(200==l.status){var a=JSON.parse(l.responseText);n(a.access_token,a.refresh_token,a.id_token,"standard"===d.flow)}else d.onAuthError&&d.onAuthError(),b&&b.setError()},l.send(j)}}function l(a){var e,c=r();if(b?"string"==typeof b&&(e=b):e="keycloak.json",e){var f=new XMLHttpRequest;f.open("GET",e,!0),f.setRequestHeader("Accept","application/json"),f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var a=JSON.parse(f.responseText);d.authServerUrl=a["auth-server-url"],d.realm=a.realm,d.clientId=a.resource,d.clientSecret=(a.credentials||{}).secret,c.setSuccess()}else c.setError()},f.send()}else{if(!b.url)for(var g=document.getElementsByTagName("script"),h=0;h<g.length;h++)if(g[h].src.match(/.*keycloak\.js/)){b.url=g[h].src.substr(0,g[h].src.indexOf("/js/keycloak.js"));break}if(!b.realm)throw"realm missing";if(!b.clientId)throw"clientId missing";d.authServerUrl=b.url,d.realm=b.realm,d.clientId=b.clientId,d.clientSecret=(b.credentials||{}).secret,c.setSuccess()}return c.promise}function m(a,b,c,e){if(d.tokenTimeoutHandle&&(clearTimeout(d.tokenTimeoutHandle),d.tokenTimeoutHandle=null),b?(d.refreshToken=b,d.refreshTokenParsed=n(b)):(delete d.refreshToken,delete d.refreshTokenParsed),c?(d.idToken=c,d.idTokenParsed=n(c)):(delete d.idToken,delete d.idTokenParsed),a){d.token=a,d.tokenParsed=n(a);var f=d.realm+"/"+d.tokenParsed.sub;if(d.tokenParsed.session_state&&(f=f+"/"+d.tokenParsed.session_state),d.sessionId=f,d.authenticated=!0,d.subject=d.tokenParsed.sub,d.realmAccess=d.tokenParsed.realm_access,d.resourceAccess=d.tokenParsed.resource_access,e){if(d.timeSkew=Math.floor(e/1e3)-d.tokenParsed.iat,console.info("[KEYCLOAK] Estimated time difference between browser and server is "+d.timeSkew+" seconds"),d.onTokenExpired){var g=1e3*(d.tokenParsed.exp-(new Date).getTime()/1e3+d.timeSkew);console.info("[KEYCLOAK] Token expires in "+Math.round(g/1e3)+" s"),g<=0?d.onTokenExpired():d.tokenTimeoutHandle=setTimeout(d.onTokenExpired,g)}}else d.updateToken(-1)}else b?d.updateToken(-1):(delete d.token,delete d.tokenParsed,delete d.subject,delete d.realmAccess,delete d.resourceAccess,d.authenticated=!1)}function n(a){switch(a=a.split(".")[1],a=a.replace("/-/g","+"),a=a.replace("/_/g","/"),a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw"Invalid token"}return a=(a+"===").slice(0,a.length+a.length%4),a=a.replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(escape(atob(a))),a=JSON.parse(a)}function o(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d}function q(a){var b=new y(a,d.responseMode).parseUri(),c=g.get(b.state);if(c&&(b.code||b.error||b.access_token||b.id_token))return b.redirectUri=c.redirectUri,b.storedNonce=c.nonce,b.prompt=c.prompt,b.fragment&&(b.newUrl+="#"+b.fragment),b}function r(){var a={setSuccess:function(b){a.success=!0,a.result=b,a.successCallback&&a.successCallback(b)},setError:function(b){a.error=!0,a.result=b,a.errorCallback&&a.errorCallback(b)},promise:{success:function(b){return a.success?b(a.result):a.error||(a.successCallback=b),a.promise},error:function(b){return a.error?b(a.result):a.success||(a.errorCallback=b),a.promise}}};return a}function s(){var b=r();if(!h.enable)return b.setSuccess(),b.promise;if(h.iframe)return b.setSuccess(),b.promise;var c=document.createElement("iframe");h.iframe=c,c.onload=function(){var a=i();"/"===a.charAt(0)?h.iframeOrigin=j():h.iframeOrigin=a.substring(0,a.indexOf("/",8)),b.setSuccess(),setTimeout(g,1e3*h.interval)};var e=i()+"/protocol/openid-connect/login-status-iframe.html";c.setAttribute("src",e),c.style.display="none",document.body.appendChild(c);var f=function(a){if(a.origin===h.iframeOrigin){"unchanged"!=a.data&&d.clearToken();for(var b=h.callbackList.splice(0,h.callbackList.length),c=b.length-1;c>=0;--c){var e=b[c];"unchanged"==a.data?e.setSuccess():e.setError()}}};a.addEventListener("message",f,!1);var g=function(){t(),d.token&&setTimeout(g,1e3*h.interval)};return b.promise}function t(){var a=r();if(h.iframe&&h.iframeOrigin){var b=d.clientId+" "+d.sessionId;h.callbackList.push(a);var c=h.iframeOrigin;1==h.callbackList.length&&h.iframe.contentWindow.postMessage(b,c)}else a.setSuccess();return a.promise}function u(b){if(!b||"default"==b)return{login:function(b){return a.location.href=d.createLoginUrl(b),r().promise},logout:function(b){return a.location.href=d.createLogoutUrl(b),r().promise},register:function(b){return a.location.href=d.createRegisterUrl(b),r().promise},accountManagement:function(){return a.location.href=d.createAccountUrl(),r().promise},redirectUri:function(a,b){if(1==arguments.length&&(b=!0),a&&a.redirectUri)return a.redirectUri;if(d.redirectUri)return d.redirectUri;var c=location.href;return location.hash&&b&&(c=c.substring(0,location.href.indexOf("#")),c+=(c.indexOf("?")==-1?"?":"&")+"redirect_fragment="+encodeURIComponent(location.hash.substring(1))),c}};if("cordova"==b)return h.enable=!1,{login:function(b){var c=r(),e="location=no";b&&"none"==b.prompt&&(e+=",hidden=yes");var f=d.createLoginUrl(b),g=a.open(f,"_blank",e),h=!1;return g.addEventListener("loadstart",function(a){if(0==a.url.indexOf("http://localhost")){var b=q(a.url);k(b,c),g.close(),h=!0}}),g.addEventListener("loaderror",function(a){if(!h)if(0==a.url.indexOf("http://localhost")){var b=q(a.url);k(b,c),g.close(),h=!0}else c.setError(),g.close()}),c.promise},logout:function(b){var g,c=r(),e=d.createLogoutUrl(b),f=a.open(e,"_blank","location=no,hidden=yes");return f.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&f.close()}),f.addEventListener("loaderror",function(a){0==a.url.indexOf("http://localhost")?f.close():(g=!0,f.close())}),f.addEventListener("exit",function(a){g?c.setError():(d.clearToken(),c.setSuccess())}),c.promise},register:function(){var b=d.createRegisterUrl(),c=a.open(b,"_blank","location=no");c.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&c.close()})},accountManagement:function(){var b=d.createAccountUrl(),c=a.open(b,"_blank","location=no");c.addEventListener("loadstart",function(a){0==a.url.indexOf("http://localhost")&&c.close()})},redirectUri:function(a){return"http://localhost"}};throw"invalid adapter type: "+b}function x(){try{return new v}catch(a){}return new w}if(!(this instanceof c))return new c(b);var e,g,d=this,f=[],h={enable:!0,callbackList:[],interval:5};d.init=function(c){function n(){var a=function(a){a||(b.prompt="none"),d.login(b).success(function(){i.setSuccess()}).error(function(){i.setError()})},b={};switch(c.onLoad){case"check-sso":h.enable?s().success(function(){t().success(function(){a(!1)}).error(function(){i.setSuccess()})}):a(!1);break;case"login-required":a(!0);break;default:throw"Invalid value for onLoad"}}function o(){var b=q(a.location.href);return b?(s(),a.history.replaceState({},null,b.newUrl),void k(b,i)):void(c?c.refreshToken?(m(c.token,c.refreshToken,c.idToken),h.enable?s().success(function(){t().success(function(){d.onAuthSuccess&&d.onAuthSuccess(),i.setSuccess()}).error(function(){d.onAuthError&&d.onAuthError(),c.onLoad?n():i.setError()})}):d.updateToken(-1).success(function(){d.onAuthSuccess&&d.onAuthSuccess(),i.setSuccess()}).error(function(){d.onAuthError&&d.onAuthError(),c.onLoad?n():i.setError()})):c.onLoad?n():i.setSuccess():i.setSuccess())}if(d.authenticated=!1,g=x(),e=c&&"cordova"===c.adapter?u("cordova"):c&&"default"===c.adapter?u():a.Cordova?u("cordova"):u(),c){if("undefined"!=typeof c.checkLoginIframe&&(h.enable=c.checkLoginIframe),c.checkLoginIframeInterval&&(h.interval=c.checkLoginIframeInterval),"login-required"===c.onLoad&&(d.loginRequired=!0),c.responseMode){if("query"!==c.responseMode&&"fragment"!==c.responseMode)throw"Invalid value for responseMode";d.responseMode=c.responseMode}if(c.flow){switch(c.flow){case"standard":d.responseType="code";break;case"implicit":d.responseType="id_token token";break;case"hybrid":d.responseType="code id_token token";break;default:throw"Invalid value for flow"}d.flow=c.flow}}d.responseMode||(d.responseMode="fragment"),d.responseType||(d.responseType="code",d.flow="standard");var f=r(),i=r();i.promise.success(function(){d.onReady&&d.onReady(d.authenticated),f.setSuccess(d.authenticated)}).error(function(a){f.setError(a)});var j=l(b);return j.success(o),j.error(function(){f.setError()}),f.promise},d.login=function(a){return e.login(a)},d.createLoginUrl=function(a){var b=o(),c=o(),f=e.redirectUri(a),h={state:b,nonce:c,redirectUri:encodeURIComponent(f)};a&&a.prompt&&(h.prompt=a.prompt),g.add(h);var j="auth";a&&"register"==a.action&&(j="registrations");var k=a&&a.scope?"openid "+a.scope:"openid",l=i()+"/protocol/openid-connect/"+j+"?client_id="+encodeURIComponent(d.clientId)+"&redirect_uri="+encodeURIComponent(f)+"&state="+encodeURIComponent(b)+"&nonce="+encodeURIComponent(c)+"&response_mode="+encodeURIComponent(d.responseMode)+"&response_type="+encodeURIComponent(d.responseType)+"&scope="+encodeURIComponent(k);return a&&a.prompt&&(l+="&prompt="+encodeURIComponent(a.prompt)),a&&a.maxAge&&(l+="&max_age="+encodeURIComponent(a.maxAge)),a&&a.loginHint&&(l+="&login_hint="+encodeURIComponent(a.loginHint)),a&&a.idpHint&&(l+="&kc_idp_hint="+encodeURIComponent(a.idpHint)),a&&a.locale&&(l+="&ui_locales="+encodeURIComponent(a.locale)),l},d.logout=function(a){return e.logout(a)},d.createLogoutUrl=function(a){var b=i()+"/protocol/openid-connect/logout?redirect_uri="+encodeURIComponent(e.redirectUri(a,!1));return b},d.register=function(a){return e.register(a)},d.createRegisterUrl=function(a){return a||(a={}),a.action="register",d.createLoginUrl(a)},d.createAccountUrl=function(a){var b=i()+"/account?referrer="+encodeURIComponent(d.clientId)+"&referrer_uri="+encodeURIComponent(e.redirectUri(a));return b},d.accountManagement=function(){return e.accountManagement()},d.hasRealmRole=function(a){var b=d.realmAccess;return!!b&&b.roles.indexOf(a)>=0},d.hasResourceRole=function(a,b){if(!d.resourceAccess)return!1;var c=d.resourceAccess[b||d.clientId];return!!c&&c.roles.indexOf(a)>=0},d.loadUserProfile=function(){var a=i()+"/account",b=new XMLHttpRequest;b.open("GET",a,!0),b.setRequestHeader("Accept","application/json"),b.setRequestHeader("Authorization","bearer "+d.token);var c=r();return b.onreadystatechange=function(){4==b.readyState&&(200==b.status?(d.profile=JSON.parse(b.responseText),c.setSuccess(d.profile)):c.setError())},b.send(),c.promise},d.loadUserInfo=function(){var a=i()+"/protocol/openid-connect/userinfo",b=new XMLHttpRequest;b.open("GET",a,!0),b.setRequestHeader("Accept","application/json"),b.setRequestHeader("Authorization","bearer "+d.token);var c=r();return b.onreadystatechange=function(){4==b.readyState&&(200==b.status?(d.userInfo=JSON.parse(b.responseText),c.setSuccess(d.userInfo)):c.setError())},b.send(),c.promise},d.isTokenExpired=function(a){if(!d.tokenParsed||!d.refreshToken&&"implicit"!=d.flow)throw"Not authenticated";var b=d.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+d.timeSkew;return a&&(b-=a),b<0},d.updateToken=function(a){var b=r();if(!d.refreshToken)return b.setError(),b.promise;a=a||5;var c=function(){var c=!1;if(a==-1?(c=!0,console.info("[KEYCLOAK] Refreshing token: forced refresh")):d.tokenParsed&&!d.isTokenExpired(a)||(c=!0,console.info("[KEYCLOAK] Refreshing token: token expired")),c){var e="grant_type=refresh_token&refresh_token="+d.refreshToken,g=i()+"/protocol/openid-connect/token";if(f.push(b),1==f.length){var h=new XMLHttpRequest;h.open("POST",g,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.withCredentials=!0,d.clientId&&d.clientSecret?h.setRequestHeader("Authorization","Basic "+btoa(d.clientId+":"+d.clientSecret)):e+="&client_id="+encodeURIComponent(d.clientId);var j=(new Date).getTime();h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status){console.info("[KEYCLOAK] Token refreshed"),j=(j+(new Date).getTime())/2;var a=JSON.parse(h.responseText);m(a.access_token,a.refresh_token,a.id_token,j),d.onAuthRefreshSuccess&&d.onAuthRefreshSuccess();for(var b=f.pop();null!=b;b=f.pop())b.setSuccess(!0)}else{console.warn("[KEYCLOAK] Failed to refresh token"),d.onAuthRefreshError&&d.onAuthRefreshError();for(var b=f.pop();null!=b;b=f.pop())b.setError(!0)}},h.send(e)}}else b.setSuccess(!1)};if(h.enable){var e=t();e.success(function(){c()}).error(function(){b.setError()})}else c();return b.promise},d.clearToken=function(){d.token&&(m(null,null,null),d.onAuthLogout&&d.onAuthLogout(),d.loginRequired&&d.login())},d.callback_id=0;var v=function(){function b(){for(var a=(new Date).getTime(),b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(c&&0==c.indexOf("kc-callback-")){var d=localStorage.getItem(c);if(d)try{var e=JSON.parse(d).expires;(!e||e<a)&&localStorage.removeItem(c)}catch(a){localStorage.removeItem(c)}}}}if(!(this instanceof v))return new v;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var a=this;a.get=function(a){if(a){var c="kc-callback-"+a,d=localStorage.getItem(c);return d&&(localStorage.removeItem(c),d=JSON.parse(d)),b(),d}},a.add=function(a){b();var c="kc-callback-"+a.state;a.expires=(new Date).getTime()+36e5,localStorage.setItem(c,JSON.stringify(a))}},w=function(){if(!(this instanceof w))return new w;var a=this;a.get=function(a){if(a){var e=c("kc-callback-"+a);return d("kc-callback-"+a,"",b(-100)),e?JSON.parse(e):void 0}},a.add=function(a){d("kc-callback-"+a.state,JSON.stringify(a),b(60))},a.removeItem=function(a){d(a,"",b(-100))};var b=function(a){var b=new Date;return b.setTime(b.getTime()+60*a*1e3),b},c=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""},d=function(a,b,c){var d=a+"="+b+"; expires="+c.toUTCString()+"; ";document.cookie=d}},y=function(a,b){if(!(this instanceof y))return new y(a,b);var c=this,d=function(){var b=null,c=null,d=null,e=a.indexOf("?"),f=a.indexOf("#",e+1);return e==-1&&f==-1?b=a:e!=-1?(b=a.substring(0,e),c=a.substring(e+1),f!=-1&&(f=c.indexOf("#"),d=c.substring(f+1),c=c.substring(0,f))):(b=a.substring(0,f),d=a.substring(f+1)),{baseUri:b,queryString:c,fragmentString:d}},e=function(a){for(var b={},c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("="),f=decodeURIComponent(e[0]),g=decodeURIComponent(e[1]);b[f]=g}return b},f=function(a,b,c){for(var d=["code","state","error","error_description"],e=0;e<d.length;e++)if(a===d[e])return c[a]=b,!0;return!1};c.parseUri=function(){var a=d(),c={};a.queryString&&(c=e(a.queryString));var g={newUrl:a.baseUri};for(var h in c)switch(h){case"redirect_fragment":g.fragment=c[h];break;default:"query"==b&&f(h,c[h],g)||(g.newUrl+=(g.newUrl.indexOf("?")==-1?"?":"&")+h+"="+c[h])}if("fragment"===b){var i={};a.fragmentString&&(i=e(a.fragmentString));for(var h in i)g[h]=i[h]}return g}}};a.Keycloak=c,"function"==typeof define&&define.amd&&define("keycloak",[],function(){return c})}(window);